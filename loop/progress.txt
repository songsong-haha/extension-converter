# Loop Progress Log

## Codebase Patterns
- Carry forward only reusable patterns, not raw logs.

---
Started: 2026-02-13T15:41:51Z
2026-02-13T15:43:28Z | item=US-002
- changed files: src/features/converter/components/converter-widget.tsx, loop/prd.json, loop/progress.txt
- reusable learnings: For session-level abandonment analytics, avoid firing in effect cleanup tied to state changes; fire on page lifecycle signals and reset per-file conversion-start state to prevent false drop-off suppression.
- time (UTC): 2026-02-13T16:11:57Z
- item id: US-002
- changed files: src/features/converter/components/converter-widget.tsx, loop/prd.json, loop/progress.txt
- reusable learnings: Guard sessionStorage access for pre-conversion drop-off analytics so private-mode/storage failures do not break one-per-session event capture; normalize source-format payload casing for consistent analytics dimensions.

- time (UTC): 2026-02-13T16:45:38Z
- item id: US-001
- changed files: src/features/converter/components/converter-widget.tsx, tests/e2e/home.spec.ts, loop/prd.json, loop/progress.txt
- reusable learnings: For image-conversion e2e, use a known-valid in-memory tiny GIF payload to avoid canvas decode flakiness; assert trust copy only after successful conversion status.

- time (UTC): 2026-02-13T16:49:05Z
- item id: US-001
- changed files: loop/progress.txt
- reusable learnings: When a loop-selected ticket is already implemented on its task branch, re-run the full gate (`lint`, `build`, `test:e2e`) before promotion and record a fresh progress checkpoint for traceability.

- time (UTC): 2026-02-13T16:57:13Z
- item id: US-001
- changed files: loop/progress.txt
- reusable learnings: If a selected story is already functionally implemented, run the full required gate and record a new promotion checkpoint before branch sync and main fast-forward.

## 2026-02-13T17:27:57Z
- item: US-001
- changed files:
  - src/features/analytics/lib/ga.ts
  - src/features/converter/components/converter-widget.tsx
  - src/features/converter/components/format-selector.tsx
  - tests/e2e/home.spec.ts
  - loop/prd.json
- reusable learnings:
  - Gate growth UX experiments behind a `NEXT_PUBLIC_*` variant flag and default to `variant` for measurable rollout.
  - Track experiment exposure once-per-file state with a `useRef` guard to avoid duplicate analytics events from rerenders.
  - Keep baseline conversion events (`format_selected`) and add experiment context params instead of replacing existing event names.
